<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>什么是OIDC | Jenna233</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="OIDC 介绍各种应用都需要做用户验证。最简单的方式是在本地维护一个数据库，存放用户账户和证书等数据。这种方式对于业务来说可能会不太友好： 注册和账户创建过程本来就很无聊。对于很多电商网站来说，它们会允许非登陆用户添加购物车，然后让用户下单时再注册。乏味的注册流程可能会导致很多用户放弃购买。对于那些提供多个应用的企业来说，让各个应用维护各自的用户数据库，不管从管理还是安全层面来说，都是一个很大的负">
<meta property="og:type" content="article">
<meta property="og:title" content="什么是OIDC">
<meta property="og:url" content="https://jenna233.github.io/2020/10/05/%E4%BB%80%E4%B9%88%E6%98%AFOIDC/index.html">
<meta property="og:site_name" content="Jenna233">
<meta property="og:description" content="OIDC 介绍各种应用都需要做用户验证。最简单的方式是在本地维护一个数据库，存放用户账户和证书等数据。这种方式对于业务来说可能会不太友好： 注册和账户创建过程本来就很无聊。对于很多电商网站来说，它们会允许非登陆用户添加购物车，然后让用户下单时再注册。乏味的注册流程可能会导致很多用户放弃购买。对于那些提供多个应用的企业来说，让各个应用维护各自的用户数据库，不管从管理还是安全层面来说，都是一个很大的负">
<meta property="og:locale">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/15531792-0f1716a32d129fd9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/15531792-b5ba35e55b804e0a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="article:published_time" content="2020-10-05T09:11:10.000Z">
<meta property="article:modified_time" content="2020-10-05T09:12:20.968Z">
<meta property="article:author" content="Jenna233">
<meta property="article:tag" content="安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/15531792-0f1716a32d129fd9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
  
    <link rel="alternate" href="/atom.xml" title="Jenna233" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/tocas.css">

  
<link rel="stylesheet" href="/css/animate.css">

  
<link rel="stylesheet" href="/css/style.css">

  <style type="text/css">
    a.title-link:hover{
        color: #34b2db !important;
    }

    a.title-link:active{
        color: #2075c1 !important;
    }

    #menu-color-id{
        background : #f7f7f7;
    }

    #menu-color-id a{
        color: #5a5a5a;
    }
  </style>
  
<script src="/js/tocas.js"></script>

  

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
<!-- navigation -->

<div class="ts fluid basic link big menu" id="menu-color-id">

    <!-- ejs : align to post page or index page -->
        
            <div class="ts very narrow container">
        

        
            <a class="item" href="/">Home</a>
        
            <a class="item" href="/archives">Archives</a>
        
    </div>
</div>
<!-- the end of navigation -->

<!-- big bang title -->
<div class="ts padded horizontally fitted fluid slate" style="background-color: #f7f7f7;">
    <!-- ejs : align to post page or index page -->
    
        <div class="ts very narrow container">
    
        <!-- Title -->
        <h1 class="ts eleven wide column header be-center-h1">
            <span style="color: #404040;" id="big-title">Jenna233</span>
            <div class="sub header" id="slogan-bar" style=" margin-top: 15px; color: #404040;"></div>
        </h1>
        <!-- the end of title -->
    </div>
</div>
<!-- the end of big bang title -->


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">

<!-- main section -->
<div class="ts text container">
        <!-- left section -->
        <div class="column" style=" padding: 35px; ">
            <!-- Articles -->
                
                <h1 class="ts header">
                    <span style="color: #333;">什么是OIDC</span>
                    <div class="sub header" style="color: #808080;">Publish: 2020/10/5 
                     &nbsp;&nbsp;
                        <ul class="unstyled radius-tag -list" itemprop="keywords"><li class="unstyled radius-tag -list-item"><a class="unstyled radius-tag -list-link" href="/tags/%E5%AE%89%E5%85%A8/" rel="tag">安全</a></li></ul>
                    
                    </div>
                </h1>

                <h1 id="OIDC-介绍"><a href="#OIDC-介绍" class="headerlink" title="OIDC 介绍"></a>OIDC 介绍</h1><p>各种应用都需要做用户验证。最简单的方式是在本地维护一个数据库，存放用户账户和证书等数据。这种方式对于业务来说可能会不太友好：</p>
<p>注册和账户创建过程本来就很无聊。对于很多电商网站来说，它们会允许非登陆用户添加购物车，然后让用户下单时再注册。乏味的注册流程可能会导致很多用户放弃购买。<br>对于那些提供多个应用的企业来说，让各个应用维护各自的用户数据库，不管从管理还是安全层面来说，都是一个很大的负担。<br>对于这个问题，更好的方案是将用户认证和授权这些事情交给专门的identity provider（idp）服务来处理。</p>
<p>google、facebook、twitter这些大厂，就为它们的注册用户提供了这类idp服务。一个网站可以通过使用这类idp服务来极大简化用户的注册和登录流程。</p>
<h1 id="Open-ID特性"><a href="#Open-ID特性" class="headerlink" title="Open ID特性"></a>Open ID特性</h1><p>OpenID Connect是位于OAuth2.0协议之上的身份层。 它使客户端能够基于授权服务器的验证来验证最终用户的身份。OAuth2.0提供了授权，即基于权限验证是否有权访问某些内容的过程。 OpenID Connect提供身份验证，即验证身份的过程。  这可以通过表单身份验证来完成，其中sql服务器存储必要的信息以对用户进行身份验证。</p>
<p>OpenID Connect在2014年发行。虽然它不是第一个idp标准，但从可用性、简单性方面来说，它可能是最好的。OpenID Connect从SAML和OpenID 1.0/2.0中做了大量借鉴。</p>
<p>oAuth2.0使用access token来授权三方应用访问受保护的信息。OpenID Connect遵循oAuth2.0协议流程，并在这个基础上提供了id token来解决三方应用的用户身份认证问题。OpenID Connect将用户身份认证信息以id token的方式给到三方应用。id token基于JWT(json web token）进行封装，具有自包含性、紧凑性和防篡改性等特点。三方应用在验证完id token的正确性后，可以进一步通过oAuth2授权流程获得的access token读取更多的用户信息。</p>
<p>OpenID Connect大获成功的秘诀：</p>
<ul>
<li>容易处理的id token。OpenID Connect使用JWT来给应用传递用户的身份信息。JWT以其高安全性（防止token被伪造和篡改）、跨语言、支持过期、自包含等特性而著称，非常适合作为token来使用。</li>
<li>基于oAuth2.0协议。id token是经过oAuth2.0流程来获取的，这个流程即支持web应用，也支持原生app。</li>
<li>简单。OpenID Connect足够简单。但同时也提供了大量的功能和安全选项以满足企业级业务需求。</li>
</ul>
<p>OpenID Connect所涉及的角色如下：</p>
<ul>
<li>用户。</li>
<li>RP：Relying Party，申请授信信息的可信客户端（既上文中提到的三方应用）。</li>
<li>OP：OpenID Provider，提供身份认证的服务方，比如google和facebook等公司的系统。</li>
<li>id token：包含身份认证信息的JWT。</li>
<li>user info api，返回用户信息的接口，当RP使用id token来访问时，返回授权用户的信息。</li>
</ul>
<h1 id="Open-ID-认证流程"><a href="#Open-ID-认证流程" class="headerlink" title="Open ID 认证流程"></a>Open ID 认证流程</h1><p>身份提供者(identity provider)向最终用户提供一个ID token，该token 被编码为JWT（Json Web token），看起来像这样：<br><img src="https://upload-images.jianshu.io/upload_images/15531792-0f1716a32d129fd9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><strong>声明(Claims)</strong><br>Token 包含位于payload中的声明，这些只是id token上的属性，其中包含有关实体的值：</p>
<ul>
<li>Subject=身份提供商提供的唯一ID</li>
<li>Issuing Authority=发行令牌的身份提供商OP（<a target="_blank" rel="noopener" href="https://idp.com)/">https://idp.com）</a></li>
<li>Audience =可以使用此令牌的依赖方RP</li>
<li>Issue Date=发行令牌的日期和时间</li>
<li>Expiration Date=令牌到期的日期和时间</li>
</ul>
<p>Token 还可以包含其他请求的声明，例如电子邮件或地址。 ID Token 使用json网络签名进行数字签名，以实现完整性和不可否认性。 header，payload 和signature被组合到一个JWT中。</p>
<p><strong>Scopes</strong><br>ID Token 包含用于检索信息的声明(claims)，但也可以使用scopes。 这些是包含声明的特定信息集。 OpenID Connect中预定义了四个标准范围，一个是openid，这是强制性的，另外四个是可选的。</p>
<ul>
<li>openid（这指定openid是必需的，是强制性的！）</li>
<li>profile（基本个人资料信息，可选）</li>
<li>email （可选）</li>
<li>address（可选）</li>
<li>phone（可选）</li>
</ul>
<h3 id="认证流程"><a href="#认证流程" class="headerlink" title="认证流程"></a>认证流程</h3><p><strong>认证代码流(Authorization code flow)</strong><br>成功验证客户端后，authentication code flow 将返回authentication code。 这可以通过表单身份验证（用户名和密码）完成。 客户端收到authentication code 后，客户端可以使用authentication code直接从身份提供者访问access_token或id_token。 ID或访问令牌永远不会公开给客户端。 对于常规Web应用程序/原生移动应用程序/台式机原生应用程序，此流程非常理想。</p>
<p>[站外图片上传中…(image-a4847-1601887935672)]</p>
<p><strong>隐式流(Implicit code flow)</strong><br>客户端经过身份验证后，隐式流向浏览器公开ID和访问令牌。 你可能已经知道，这是最不安全的身份验证方法。 XSS和网络钓鱼是将访问令牌暴露给入侵者的主要危险之一。 在https上运行网站可以缓解其中的一些危险。 隐式流主要用于在浏览器中运行的应用程序（Javascript应用程序）。<br><img src="https://upload-images.jianshu.io/upload_images/15531792-b5ba35e55b804e0a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><strong>混合流(hybrid flow)</strong><br>混合流是代码流和隐式流的组合。 身份验证后返回id token，该令牌用于访问各种资源。 如果您需要在前端和后端使用单独的令牌，这将特别有用。一个token用来访问资源（API）， 另外一个token用来获取刷新令牌(refresh token)。</p>
<p>详细信息可以查看官网：<a href="%5Bhttps://openid.net/connect/%5D(https://openid.net/connect/)">Open Id 介绍</a></p>

            <!-- / the end of articles -->
        </div>
        <!-- / left section -->
        
        
            <hr/>
            <div id="disqus_thread" style=" margin-top: 15px; margin-bottom: 25px; "></div>
            <script>
                /**
                *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
                /*
                var disqus_config = function () {
                this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                };
                */
                (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');
                s.src = 'https://morgan-hexo-theme.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        

        <!-- Next Post and Prev Post -->
        
        <hr/>
        <div class="next-prev-post-section">
            
                <a href="#"></a>
            
            
                <a href="/2020/10/03/%E4%BB%80%E4%B9%88%E6%98%AFSAML/" class="styled-border">
                    
                    什么是SAML
                    →
                </a>
            
        </div>
        
</div>
<script type="text/javascript">
    let img = document.getElementsByTagName("img");
    for(let i = 0; i < img.length; i++){
        img[i].className += " ts fluid image";
    }
</script>
<!-- / main section -->

<!-- copyright -->
<div class="ts attached secondary segment">
    <div class="ts narrow container">
        <br>
        <div class="ts large center aligned header">
            Powered by Hexo, Theme designs by @hpcslag.
            <div class="smaller sub header">
                Style-Framework Tocas-UI designs by @yamioldmel 
            </div>
        </div>
        <br>
    </div>
</div>
<!-- / copyright -->
<script type="text/javascript">
    
    const slogans = ["Hallo, dit is mijn blog","嗨，這是我的博客!","안녕하세요, 제 블로그입니다.","Hi, This is my blog!","こんにちは、私のブログへようこそ!","مرحبا، مرحبا بك في مدونتي"];
</script>

<script src="/js/script.js"></script>

</body>
</html>